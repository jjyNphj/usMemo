<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap 
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="List">
	<typeAlias alias="listDTO" type="com.twogether.usMemo.dto.ListDTO" />
	
	<parameterMap id="listParamMap" class="listDTO">
		<parameter property="name" jdbcType="varchar" javaType="java.lang.String" mode="IN"/>
  		<parameter property="bNum" jdbcType="NUMBER" javaType="java.lang.Integer" mode="IN"/>
 	</parameterMap> 
 	

	<resultMap id="ListMap" class="listDTO">
       <result property="num" column="num"/>
       <result property="bNum" column="bNum"/>
   <!--     <result property="location" column="location"/>
    -->    <result property="name" column="name"/>
       <result property="llink" column="llink"/>
       <result property="rlink" column="rlink"/>
    </resultMap>

	<select id="getListByNum" parameterClass="int" resultMap="ListMap">
		select * from List where bNum=#bNum# order by llink
	</select>
	
	<delete id="deleteListBybNum"  parameterClass="int" >
	    <!-- list.bNum=board.num이 같으면서 전달받은 bNum의 값이 board.num값과 같은 list의 행 모두 삭제  -->
	    delete from list where exists (select 1 from board where list.bNum = board.num and board.num=#bNum#)
	</delete>
	
<!-- 	<insert id="addList" parameterClass="listDTO">
	<selectKey  keyProperty="llink" resultClass="int" >
		select num from list where bNum=#bNum# and rlink=-1
	</selectKey>
		insert into list values(list_num_seq.nextval,#name#,#bNum#,#location#,#llink#,-1 )
	</insert>
	
	<update id="updateLocation" parameterClass="listDTO">
		update list set location=#location# where num=#num#
	</update> -->
	
	<procedure id="addListProc" parameterMap="listParamMap">
	{ call addListProcedure(?,?) }
	</procedure>
	
	<update id="update_rlink" parameterClass="listDTO">
		update list set rlink=#rlink# where num=#num#
	</update>
	<update id="update_llink" parameterClass="listDTO">
		update list set llink=#llink# where num=#num#
	</update>
	<update id="update_allLink" parameterClass="listDTO">
		update list set llink=#llink#, rlink=#rlink# where num=#num#
	</update>
	
	

</sqlMap>
	
