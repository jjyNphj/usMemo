<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap 
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
	
	<sqlMap namespace="Activity">
		<typeAlias alias="member" type="com.twogether.usMemo.dto.Member"/>
		<typeAlias alias="activity" type="com.twogether.usMemo.dto.Activity"/>
		
		<resultMap id="activityMap" class="activity">
			<result property="num" column="num"/>
			<result property="activity_num" column="activity_num"/>
			<result property="memId" column="memId"/>
			<result property="bNum" column="bNum"/>
			<result property="write_time" column="write_time"/>
			<result property="value_num" column="value_num" nullValue="-1"/>
			<result property="value_string" column="value_string" nullValue="-1"/>
			<result property="to_num" column="to_num" nullValue="-1"/>
			<result property="from_num" column="from_num" nullValue="-1"/>
			<result property="format_num" column="format_num"/>
			<result property="activity_name" column="activity_name"/>
			<result property="format" column="format"/>
			<result property="name" column="name"/>
			<result property="nickname" column="nickname"/>
			<result property="profile_image" column="profile_image"/>
			<result property="email" column="email"/>
		</resultMap>
		
		<insert id="createBoard" parameterClass="activity">
			<selectKey keyProperty="activity_num" resultClass="int">
				select num from activity_format where activity_name='create_board'
			</selectKey>
			insert into activity values(activity_num_seq.nextval,#activity_num#,#memId#,#bNum#,sysdate,null,null,null,null)
		</insert>
		
		<select id="getAllActivity" parameterClass="int" resultMap="activityMap">
			select a.num, a.activity_num, a.bNum, a.value_num, a.to_num, a.from_num,
					a.memId,a.value_string,a.write_time,f.num as format_num,f.activity_name,f.format,
					m.name,m.nickname,m.profile_image,m.email
			from activity a
			inner join activity_format f 
			on a.activity_num=f.num
			inner join member m 
			on a.memId=m.id 
			where bNum=#bNum# 
			order by write_time desc
		</select>
		
		<insert id="addList" parameterClass="activity">
			<selectKey keyProperty="activity_num" resultClass="int">
				select num from activity_format where activity_name='addList'
			</selectKey>
			insert into activity values(activity_num_seq.nextval,#activity_num#,#memId#,#bNum#,sysdate,#value_num#,null,null,null)
		</insert>
		<insert id="addCard" parameterClass="activity">
			<selectKey keyProperty="activity_num" resultClass="int">
				select num from activity_format where activity_name='addCard'
			</selectKey>
			insert into activity values(activity_num_seq.nextval,#activity_num#,#memId#,#bNum#,sysdate,#value_num#,null,#to_num#,null)
		</insert>
		
		<insert id="updateCardLocation">
			<selectKey keyProperty="activity_num" resultClass="int">
				select num from activity_format where activity_name='updateCardLocation'
			</selectKey>
			insert into activity values(activity_num_seq.nextval,#activity_num#,#memId#,#bNum#,sysdate,#value_num#,null,#to_num#,#from_num#)
		</insert>
		<insert id="addFriend">
			<selectKey keyProperty="activity_num" resultClass="int">
				select num from activity_format where activity_name='addFriend'
			</selectKey>
			insert into activity values(activity_num_seq.nextval,#activity_num#,#memId#,#bNum#,sysdate,null,#value_string#,null,null)
		</insert>

	</sqlMap>
	