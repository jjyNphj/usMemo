create or replace procedure addListProcedure
(in_name IN varchar, in_bNum IN number)
is 
preNum number
countNum number
cur_seq number
begin
	select count(num) into countNum from list where bNum=in_bNum
	
	IF countNum=0 THEN
	insert into list values(list_num_seq.nextval,in_name,in_bNum,-1,-1 )
	
	ELSE
	select num into preNum from list where bNum=in_bNum and rlink=-1
	insert into list values(list_num_seq.nextval,in_name,in_bNum,preNum,-1 )
	select list_num_seq.currval into cur_seq from DUAL
	--현재 시퀀스값을 cur_seq에 저장하고 사용! 
	update list set rlink = cur_seq where num=preNum
	
	END IF
	
	commit
end
/



======================================
create or replace procedure addListProcedure
(name IN varchar, bNum IN number)
is 
preNum number
countNum number
cur_seq number
begin
	select count(num) into countNum from list where bNum=bNum
	
	IF countNum=0 THEN
	insert into list values(list_num_seq.nextval,name,bNum,-1,-1 )
	
	ELSE
	select num into preNum from list where bNum=bNum and rlink=-1
	insert into list values(list_num_seq.nextval,name,bNum,preNum,-1 )
	select list_num_seq.currval into cur_seq from DUAL
	--현재 시퀀스값을 cur_seq에 저장하고 사용! 
	update list set rlink = cur_seq where num=preNum
	
	END IF
	
	commit
end
/



======================sql파일에서 ==================
create or replace procedure addListProcedure
(in_name IN varchar, in_bNum IN number)
is 
preNum number;
countNum number;
cur_seq number;
begin
	select count(num) into countNum from list where bNum=in_bNum;
	
	IF countNum=0 THEN
	insert into list values(list_num_seq.nextval,in_name,in_bNum,-1,-1 );
	
	ELSE
	select num into preNum from list where bNum=in_bNum and rlink=-1;
	insert into list values(list_num_seq.nextval,in_name,in_bNum,preNum,-1 );
	select list_num_seq.currval into cur_seq from DUAL;
	--현재 시퀀스값을 cur_seq에 저장하고 사용! 
	update list set rlink = cur_seq where num=preNum;
	
	END IF;
	
	commit;
end;
/

================card procedure======================
create or replace procedure addCardProcedure
(in_name IN varchar, in_memId IN number,in_lNum In number)
is 
preNum number;
countNum number;
cur_seq number;
begin
	select count(num) into countNum from card where lNum=in_lNum;
	
	IF countNum=0 THEN
	insert into card values(card_num_seq.nextval,in_name,null,null,in_memId,sysdate,in_lNum,-1,-1 );
	ELSE
	select num into preNum from card where lNum=in_lNum and rlink=-1;
	insert into card values(card_num_seq.nextval,in_name,null,null,in_memId,sysdate,in_lNum,preNum,-1 );
	select card_num_seq.currval into cur_seq from DUAL;
	--현재 시퀀스값을 cur_seq에 저장하고 사용! 
	update card set rlink = cur_seq where num=preNum;
	
	END IF;
	
	commit;
end;
/